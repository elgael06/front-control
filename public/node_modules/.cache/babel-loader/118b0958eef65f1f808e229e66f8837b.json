{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __values = this && this.__values || function (o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar AbstractRSSReader_1 = require(\"./AbstractRSSReader\");\n\nvar Pair_1 = require(\"./Pair\");\n\nvar Result_1 = require(\"../../Result\");\n\nvar DecodeHintType_1 = require(\"../../DecodeHintType\");\n\nvar NotFoundException_1 = require(\"../../NotFoundException\");\n\nvar StringBuilder_1 = require(\"../../util/StringBuilder\");\n\nvar BarcodeFormat_1 = require(\"../../BarcodeFormat\");\n\nvar ResultPoint_1 = require(\"../../ResultPoint\");\n\nvar FinderPattern_1 = require(\"./FinderPattern\");\n\nvar DataCharacter_1 = require(\"./DataCharacter\");\n\nvar MathUtils_1 = require(\"../../common/detector/MathUtils\");\n\nvar RSSUtils_1 = require(\"./RSSUtils\");\n\nvar System_1 = require(\"../../util/System\");\n\nvar OneDReader_1 = require(\"../OneDReader\");\n\nvar RSS14Reader =\n/** @class */\nfunction (_super) {\n  __extends(RSS14Reader, _super);\n\n  function RSS14Reader() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.possibleLeftPairs = [];\n    _this.possibleRightPairs = [];\n    return _this;\n  }\n\n  RSS14Reader.prototype.decodeRow = function (rowNumber, row, hints) {\n    var e_1, _a, e_2, _b;\n\n    var leftPair = this.decodePair(row, false, rowNumber, hints);\n    RSS14Reader.addOrTally(this.possibleLeftPairs, leftPair);\n    row.reverse();\n    var rightPair = this.decodePair(row, true, rowNumber, hints);\n    RSS14Reader.addOrTally(this.possibleRightPairs, rightPair);\n    row.reverse();\n\n    try {\n      for (var _c = __values(this.possibleLeftPairs), _d = _c.next(); !_d.done; _d = _c.next()) {\n        var left = _d.value;\n\n        if (left.getCount() > 1) {\n          try {\n            for (var _e = __values(this.possibleRightPairs), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var right = _f.value;\n\n              if (right.getCount() > 1 && RSS14Reader.checkChecksum(left, right)) {\n                return RSS14Reader.constructResult(left, right);\n              }\n            }\n          } catch (e_2_1) {\n            e_2 = {\n              error: e_2_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n            } finally {\n              if (e_2) throw e_2.error;\n            }\n          }\n        }\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n\n    throw new NotFoundException_1.default();\n  };\n\n  RSS14Reader.addOrTally = function (possiblePairs, pair) {\n    var e_3, _a;\n\n    if (pair == null) {\n      return;\n    }\n\n    var found = false;\n\n    try {\n      for (var possiblePairs_1 = __values(possiblePairs), possiblePairs_1_1 = possiblePairs_1.next(); !possiblePairs_1_1.done; possiblePairs_1_1 = possiblePairs_1.next()) {\n        var other = possiblePairs_1_1.value;\n\n        if (other.getValue() === pair.getValue()) {\n          other.incrementCount();\n          found = true;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (possiblePairs_1_1 && !possiblePairs_1_1.done && (_a = possiblePairs_1.return)) _a.call(possiblePairs_1);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!found) {\n      possiblePairs.push(pair);\n    }\n  };\n\n  RSS14Reader.prototype.reset = function () {\n    this.possibleLeftPairs.length = 0;\n    this.possibleRightPairs.length = 0;\n  };\n\n  RSS14Reader.constructResult = function (leftPair, rightPair) {\n    var symbolValue = 4537077 * leftPair.getValue() + rightPair.getValue();\n    var text = new String(symbolValue).toString();\n    var buffer = new StringBuilder_1.default();\n\n    for (var i = 13 - text.length; i > 0; i--) {\n      buffer.append('0');\n    }\n\n    buffer.append(text);\n    var checkDigit = 0;\n\n    for (var i = 0; i < 13; i++) {\n      var digit = buffer.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n      checkDigit += (i & 0x01) === 0 ? 3 * digit : digit;\n    }\n\n    checkDigit = 10 - checkDigit % 10;\n\n    if (checkDigit === 10) {\n      checkDigit = 0;\n    }\n\n    buffer.append(checkDigit.toString());\n    var leftPoints = leftPair.getFinderPattern().getResultPoints();\n    var rightPoints = rightPair.getFinderPattern().getResultPoints();\n    return new Result_1.default(buffer.toString(), null, 0, [leftPoints[0], leftPoints[1], rightPoints[0], rightPoints[1]], BarcodeFormat_1.default.RSS_14, new Date().getTime());\n  };\n\n  RSS14Reader.checkChecksum = function (leftPair, rightPair) {\n    var checkValue = (leftPair.getChecksumPortion() + 16 * rightPair.getChecksumPortion()) % 79;\n    var targetCheckValue = 9 * leftPair.getFinderPattern().getValue() + rightPair.getFinderPattern().getValue();\n\n    if (targetCheckValue > 72) {\n      targetCheckValue--;\n    }\n\n    if (targetCheckValue > 8) {\n      targetCheckValue--;\n    }\n\n    return checkValue === targetCheckValue;\n  };\n\n  RSS14Reader.prototype.decodePair = function (row, right, rowNumber, hints) {\n    try {\n      var startEnd = this.findFinderPattern(row, right);\n      var pattern = this.parseFoundFinderPattern(row, rowNumber, right, startEnd);\n      var resultPointCallback = hints == null ? null : hints.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);\n\n      if (resultPointCallback != null) {\n        var center = (startEnd[0] + startEnd[1]) / 2.0;\n\n        if (right) {\n          // row is actually reversed\n          center = row.getSize() - 1 - center;\n        }\n\n        resultPointCallback.foundPossibleResultPoint(new ResultPoint_1.default(center, rowNumber));\n      }\n\n      var outside = this.decodeDataCharacter(row, pattern, true);\n      var inside = this.decodeDataCharacter(row, pattern, false);\n      return new Pair_1.default(1597 * outside.getValue() + inside.getValue(), outside.getChecksumPortion() + 4 * inside.getChecksumPortion(), pattern);\n    } catch (err) {\n      return null;\n    }\n  };\n\n  RSS14Reader.prototype.decodeDataCharacter = function (row, pattern, outsideChar) {\n    var counters = this.getDataCharacterCounters();\n\n    for (var x = 0; x < counters.length; x++) {\n      counters[x] = 0;\n    }\n\n    if (outsideChar) {\n      OneDReader_1.default.recordPatternInReverse(row, pattern.getStartEnd()[0], counters);\n    } else {\n      OneDReader_1.default.recordPattern(row, pattern.getStartEnd()[1] + 1, counters); // reverse it\n\n      for (var i = 0, j = counters.length - 1; i < j; i++, j--) {\n        var temp = counters[i];\n        counters[i] = counters[j];\n        counters[j] = temp;\n      }\n    }\n\n    var numModules = outsideChar ? 16 : 15;\n    var elementWidth = MathUtils_1.default.sum(new Int32Array(counters)) / numModules;\n    var oddCounts = this.getOddCounts();\n    var evenCounts = this.getEvenCounts();\n    var oddRoundingErrors = this.getOddRoundingErrors();\n    var evenRoundingErrors = this.getEvenRoundingErrors();\n\n    for (var i = 0; i < counters.length; i++) {\n      var value = counters[i] / elementWidth;\n      var count = Math.floor(value + 0.5);\n\n      if (count < 1) {\n        count = 1;\n      } else if (count > 8) {\n        count = 8;\n      }\n\n      var offset = Math.floor(i / 2);\n\n      if ((i & 0x01) === 0) {\n        oddCounts[offset] = count;\n        oddRoundingErrors[offset] = value - count;\n      } else {\n        evenCounts[offset] = count;\n        evenRoundingErrors[offset] = value - count;\n      }\n    }\n\n    this.adjustOddEvenCounts(outsideChar, numModules);\n    var oddSum = 0;\n    var oddChecksumPortion = 0;\n\n    for (var i = oddCounts.length - 1; i >= 0; i--) {\n      oddChecksumPortion *= 9;\n      oddChecksumPortion += oddCounts[i];\n      oddSum += oddCounts[i];\n    }\n\n    var evenChecksumPortion = 0;\n    var evenSum = 0;\n\n    for (var i = evenCounts.length - 1; i >= 0; i--) {\n      evenChecksumPortion *= 9;\n      evenChecksumPortion += evenCounts[i];\n      evenSum += evenCounts[i];\n    }\n\n    var checksumPortion = oddChecksumPortion + 3 * evenChecksumPortion;\n\n    if (outsideChar) {\n      if ((oddSum & 0x01) !== 0 || oddSum > 12 || oddSum < 4) {\n        throw new NotFoundException_1.default();\n      }\n\n      var group = (12 - oddSum) / 2;\n      var oddWidest = RSS14Reader.OUTSIDE_ODD_WIDEST[group];\n      var evenWidest = 9 - oddWidest;\n      var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, false);\n      var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, true);\n      var tEven = RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[group];\n      var gSum = RSS14Reader.OUTSIDE_GSUM[group];\n      return new DataCharacter_1.default(vOdd * tEven + vEven + gSum, checksumPortion);\n    } else {\n      if ((evenSum & 0x01) !== 0 || evenSum > 10 || evenSum < 4) {\n        throw new NotFoundException_1.default();\n      }\n\n      var group = (10 - evenSum) / 2;\n      var oddWidest = RSS14Reader.INSIDE_ODD_WIDEST[group];\n      var evenWidest = 9 - oddWidest;\n      var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, true);\n      var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, false);\n      var tOdd = RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[group];\n      var gSum = RSS14Reader.INSIDE_GSUM[group];\n      return new DataCharacter_1.default(vEven * tOdd + vOdd + gSum, checksumPortion);\n    }\n  };\n\n  RSS14Reader.prototype.findFinderPattern = function (row, rightFinderPattern) {\n    var counters = this.getDecodeFinderCounters();\n    counters[0] = 0;\n    counters[1] = 0;\n    counters[2] = 0;\n    counters[3] = 0;\n    var width = row.getSize();\n    var isWhite = false;\n    var rowOffset = 0;\n\n    while (rowOffset < width) {\n      isWhite = !row.get(rowOffset);\n\n      if (rightFinderPattern === isWhite) {\n        // Will encounter white first when searching for right finder pattern\n        break;\n      }\n\n      rowOffset++;\n    }\n\n    var counterPosition = 0;\n    var patternStart = rowOffset;\n\n    for (var x = rowOffset; x < width; x++) {\n      if (row.get(x) !== isWhite) {\n        counters[counterPosition]++;\n      } else {\n        if (counterPosition === 3) {\n          if (AbstractRSSReader_1.default.isFinderPattern(counters)) {\n            return [patternStart, x];\n          }\n\n          patternStart += counters[0] + counters[1];\n          counters[0] = counters[2];\n          counters[1] = counters[3];\n          counters[2] = 0;\n          counters[3] = 0;\n          counterPosition--;\n        } else {\n          counterPosition++;\n        }\n\n        counters[counterPosition] = 1;\n        isWhite = !isWhite;\n      }\n    }\n\n    throw new NotFoundException_1.default();\n  };\n\n  RSS14Reader.prototype.parseFoundFinderPattern = function (row, rowNumber, right, startEnd) {\n    // Actually we found elements 2-5\n    var firstIsBlack = row.get(startEnd[0]);\n    var firstElementStart = startEnd[0] - 1; // Locate element 1\n\n    while (firstElementStart >= 0 && firstIsBlack !== row.get(firstElementStart)) {\n      firstElementStart--;\n    }\n\n    firstElementStart++;\n    var firstCounter = startEnd[0] - firstElementStart; // Make 'counters' hold 1-4\n\n    var counters = this.getDecodeFinderCounters();\n    var copy = new Array(counters.length);\n    System_1.default.arraycopy(counters, 0, copy, 1, counters.length - 1);\n    copy[0] = firstCounter;\n    var value = this.parseFinderValue(copy, RSS14Reader.FINDER_PATTERNS);\n    var start = firstElementStart;\n    var end = startEnd[1];\n\n    if (right) {\n      // row is actually reversed\n      start = row.getSize() - 1 - start;\n      end = row.getSize() - 1 - end;\n    }\n\n    return new FinderPattern_1.default(value, [firstElementStart, startEnd[1]], start, end, rowNumber);\n  };\n\n  RSS14Reader.prototype.adjustOddEvenCounts = function (outsideChar, numModules) {\n    var oddSum = MathUtils_1.default.sum(new Int32Array(this.getOddCounts()));\n    var evenSum = MathUtils_1.default.sum(new Int32Array(this.getEvenCounts()));\n    var incrementOdd = false;\n    var decrementOdd = false;\n    var incrementEven = false;\n    var decrementEven = false;\n\n    if (outsideChar) {\n      if (oddSum > 12) {\n        decrementOdd = true;\n      } else if (oddSum < 4) {\n        incrementOdd = true;\n      }\n\n      if (evenSum > 12) {\n        decrementEven = true;\n      } else if (evenSum < 4) {\n        incrementEven = true;\n      }\n    } else {\n      if (oddSum > 11) {\n        decrementOdd = true;\n      } else if (oddSum < 5) {\n        incrementOdd = true;\n      }\n\n      if (evenSum > 10) {\n        decrementEven = true;\n      } else if (evenSum < 4) {\n        incrementEven = true;\n      }\n    }\n\n    var mismatch = oddSum + evenSum - numModules;\n    var oddParityBad = (oddSum & 0x01) === (outsideChar ? 1 : 0);\n    var evenParityBad = (evenSum & 0x01) === 1;\n\n    if (mismatch === 1) {\n      if (oddParityBad) {\n        if (evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n\n        decrementOdd = true;\n      } else {\n        if (!evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n\n        decrementEven = true;\n      }\n    } else if (mismatch === -1) {\n      if (oddParityBad) {\n        if (evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n\n        incrementOdd = true;\n      } else {\n        if (!evenParityBad) {\n          throw new NotFoundException_1.default();\n        }\n\n        incrementEven = true;\n      }\n    } else if (mismatch === 0) {\n      if (oddParityBad) {\n        if (!evenParityBad) {\n          throw new NotFoundException_1.default();\n        } // Both bad\n\n\n        if (oddSum < evenSum) {\n          incrementOdd = true;\n          decrementEven = true;\n        } else {\n          decrementOdd = true;\n          incrementEven = true;\n        }\n      } else {\n        if (evenParityBad) {\n          throw new NotFoundException_1.default();\n        } // Nothing to do!\n\n      }\n    } else {\n      throw new NotFoundException_1.default();\n    }\n\n    if (incrementOdd) {\n      if (decrementOdd) {\n        throw new NotFoundException_1.default();\n      }\n\n      AbstractRSSReader_1.default.increment(this.getOddCounts(), this.getOddRoundingErrors());\n    }\n\n    if (decrementOdd) {\n      AbstractRSSReader_1.default.decrement(this.getOddCounts(), this.getOddRoundingErrors());\n    }\n\n    if (incrementEven) {\n      if (decrementEven) {\n        throw new NotFoundException_1.default();\n      }\n\n      AbstractRSSReader_1.default.increment(this.getEvenCounts(), this.getOddRoundingErrors());\n    }\n\n    if (decrementEven) {\n      AbstractRSSReader_1.default.decrement(this.getEvenCounts(), this.getEvenRoundingErrors());\n    }\n  };\n\n  RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET = [1, 10, 34, 70, 126];\n  RSS14Reader.INSIDE_ODD_TOTAL_SUBSET = [4, 20, 48, 81];\n  RSS14Reader.OUTSIDE_GSUM = [0, 161, 961, 2015, 2715];\n  RSS14Reader.INSIDE_GSUM = [0, 336, 1036, 1516];\n  RSS14Reader.OUTSIDE_ODD_WIDEST = [8, 6, 4, 3, 1];\n  RSS14Reader.INSIDE_ODD_WIDEST = [2, 4, 6, 8];\n  RSS14Reader.FINDER_PATTERNS = [[3, 8, 2, 1], [3, 5, 5, 1], [3, 3, 7, 1], [3, 1, 9, 1], [2, 7, 4, 1], [2, 5, 6, 1], [2, 3, 8, 1], [1, 5, 7, 1], [1, 3, 9, 1]];\n  return RSS14Reader;\n}(AbstractRSSReader_1.default);\n\nexports.default = RSS14Reader;","map":{"version":3,"sources":["../../../../src/core/oned/rss/RSS14Reader.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function (o) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\n    if (m) return m.call(o);\n    return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar AbstractRSSReader_1 = require(\"./AbstractRSSReader\");\nvar Pair_1 = require(\"./Pair\");\nvar Result_1 = require(\"../../Result\");\nvar DecodeHintType_1 = require(\"../../DecodeHintType\");\nvar NotFoundException_1 = require(\"../../NotFoundException\");\nvar StringBuilder_1 = require(\"../../util/StringBuilder\");\nvar BarcodeFormat_1 = require(\"../../BarcodeFormat\");\nvar ResultPoint_1 = require(\"../../ResultPoint\");\nvar FinderPattern_1 = require(\"./FinderPattern\");\nvar DataCharacter_1 = require(\"./DataCharacter\");\nvar MathUtils_1 = require(\"../../common/detector/MathUtils\");\nvar RSSUtils_1 = require(\"./RSSUtils\");\nvar System_1 = require(\"../../util/System\");\nvar OneDReader_1 = require(\"../OneDReader\");\nvar RSS14Reader = /** @class */ (function (_super) {\n    __extends(RSS14Reader, _super);\n    function RSS14Reader() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.possibleLeftPairs = [];\n        _this.possibleRightPairs = [];\n        return _this;\n    }\n    RSS14Reader.prototype.decodeRow = function (rowNumber, row, hints) {\n        var e_1, _a, e_2, _b;\n        var leftPair = this.decodePair(row, false, rowNumber, hints);\n        RSS14Reader.addOrTally(this.possibleLeftPairs, leftPair);\n        row.reverse();\n        var rightPair = this.decodePair(row, true, rowNumber, hints);\n        RSS14Reader.addOrTally(this.possibleRightPairs, rightPair);\n        row.reverse();\n        try {\n            for (var _c = __values(this.possibleLeftPairs), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var left = _d.value;\n                if (left.getCount() > 1) {\n                    try {\n                        for (var _e = __values(this.possibleRightPairs), _f = _e.next(); !_f.done; _f = _e.next()) {\n                            var right = _f.value;\n                            if (right.getCount() > 1 && RSS14Reader.checkChecksum(left, right)) {\n                                return RSS14Reader.constructResult(left, right);\n                            }\n                        }\n                    }\n                    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                    finally {\n                        try {\n                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                        }\n                        finally { if (e_2) throw e_2.error; }\n                    }\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        throw new NotFoundException_1.default();\n    };\n    RSS14Reader.addOrTally = function (possiblePairs, pair) {\n        var e_3, _a;\n        if (pair == null) {\n            return;\n        }\n        var found = false;\n        try {\n            for (var possiblePairs_1 = __values(possiblePairs), possiblePairs_1_1 = possiblePairs_1.next(); !possiblePairs_1_1.done; possiblePairs_1_1 = possiblePairs_1.next()) {\n                var other = possiblePairs_1_1.value;\n                if (other.getValue() === pair.getValue()) {\n                    other.incrementCount();\n                    found = true;\n                    break;\n                }\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (possiblePairs_1_1 && !possiblePairs_1_1.done && (_a = possiblePairs_1.return)) _a.call(possiblePairs_1);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n        if (!found) {\n            possiblePairs.push(pair);\n        }\n    };\n    RSS14Reader.prototype.reset = function () {\n        this.possibleLeftPairs.length = 0;\n        this.possibleRightPairs.length = 0;\n    };\n    RSS14Reader.constructResult = function (leftPair, rightPair) {\n        var symbolValue = 4537077 * leftPair.getValue() + rightPair.getValue();\n        var text = new String(symbolValue).toString();\n        var buffer = new StringBuilder_1.default();\n        for (var i = 13 - text.length; i > 0; i--) {\n            buffer.append('0');\n        }\n        buffer.append(text);\n        var checkDigit = 0;\n        for (var i = 0; i < 13; i++) {\n            var digit = buffer.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n            checkDigit += ((i & 0x01) === 0) ? 3 * digit : digit;\n        }\n        checkDigit = 10 - (checkDigit % 10);\n        if (checkDigit === 10) {\n            checkDigit = 0;\n        }\n        buffer.append(checkDigit.toString());\n        var leftPoints = leftPair.getFinderPattern().getResultPoints();\n        var rightPoints = rightPair.getFinderPattern().getResultPoints();\n        return new Result_1.default(buffer.toString(), null, 0, [leftPoints[0], leftPoints[1], rightPoints[0], rightPoints[1]], BarcodeFormat_1.default.RSS_14, new Date().getTime());\n    };\n    RSS14Reader.checkChecksum = function (leftPair, rightPair) {\n        var checkValue = (leftPair.getChecksumPortion() + 16 * rightPair.getChecksumPortion()) % 79;\n        var targetCheckValue = 9 * leftPair.getFinderPattern().getValue() + rightPair.getFinderPattern().getValue();\n        if (targetCheckValue > 72) {\n            targetCheckValue--;\n        }\n        if (targetCheckValue > 8) {\n            targetCheckValue--;\n        }\n        return checkValue === targetCheckValue;\n    };\n    RSS14Reader.prototype.decodePair = function (row, right, rowNumber, hints) {\n        try {\n            var startEnd = this.findFinderPattern(row, right);\n            var pattern = this.parseFoundFinderPattern(row, rowNumber, right, startEnd);\n            var resultPointCallback = hints == null ? null : hints.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);\n            if (resultPointCallback != null) {\n                var center = (startEnd[0] + startEnd[1]) / 2.0;\n                if (right) {\n                    // row is actually reversed\n                    center = row.getSize() - 1 - center;\n                }\n                resultPointCallback.foundPossibleResultPoint(new ResultPoint_1.default(center, rowNumber));\n            }\n            var outside = this.decodeDataCharacter(row, pattern, true);\n            var inside = this.decodeDataCharacter(row, pattern, false);\n            return new Pair_1.default(1597 * outside.getValue() + inside.getValue(), outside.getChecksumPortion() + 4 * inside.getChecksumPortion(), pattern);\n        }\n        catch (err) {\n            return null;\n        }\n    };\n    RSS14Reader.prototype.decodeDataCharacter = function (row, pattern, outsideChar) {\n        var counters = this.getDataCharacterCounters();\n        for (var x = 0; x < counters.length; x++) {\n            counters[x] = 0;\n        }\n        if (outsideChar) {\n            OneDReader_1.default.recordPatternInReverse(row, pattern.getStartEnd()[0], counters);\n        }\n        else {\n            OneDReader_1.default.recordPattern(row, pattern.getStartEnd()[1] + 1, counters);\n            // reverse it\n            for (var i = 0, j = counters.length - 1; i < j; i++, j--) {\n                var temp = counters[i];\n                counters[i] = counters[j];\n                counters[j] = temp;\n            }\n        }\n        var numModules = outsideChar ? 16 : 15;\n        var elementWidth = MathUtils_1.default.sum(new Int32Array(counters)) / numModules;\n        var oddCounts = this.getOddCounts();\n        var evenCounts = this.getEvenCounts();\n        var oddRoundingErrors = this.getOddRoundingErrors();\n        var evenRoundingErrors = this.getEvenRoundingErrors();\n        for (var i = 0; i < counters.length; i++) {\n            var value = counters[i] / elementWidth;\n            var count = Math.floor(value + 0.5);\n            if (count < 1) {\n                count = 1;\n            }\n            else if (count > 8) {\n                count = 8;\n            }\n            var offset = Math.floor(i / 2);\n            if ((i & 0x01) === 0) {\n                oddCounts[offset] = count;\n                oddRoundingErrors[offset] = value - count;\n            }\n            else {\n                evenCounts[offset] = count;\n                evenRoundingErrors[offset] = value - count;\n            }\n        }\n        this.adjustOddEvenCounts(outsideChar, numModules);\n        var oddSum = 0;\n        var oddChecksumPortion = 0;\n        for (var i = oddCounts.length - 1; i >= 0; i--) {\n            oddChecksumPortion *= 9;\n            oddChecksumPortion += oddCounts[i];\n            oddSum += oddCounts[i];\n        }\n        var evenChecksumPortion = 0;\n        var evenSum = 0;\n        for (var i = evenCounts.length - 1; i >= 0; i--) {\n            evenChecksumPortion *= 9;\n            evenChecksumPortion += evenCounts[i];\n            evenSum += evenCounts[i];\n        }\n        var checksumPortion = oddChecksumPortion + 3 * evenChecksumPortion;\n        if (outsideChar) {\n            if ((oddSum & 0x01) !== 0 || oddSum > 12 || oddSum < 4) {\n                throw new NotFoundException_1.default();\n            }\n            var group = (12 - oddSum) / 2;\n            var oddWidest = RSS14Reader.OUTSIDE_ODD_WIDEST[group];\n            var evenWidest = 9 - oddWidest;\n            var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, false);\n            var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, true);\n            var tEven = RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[group];\n            var gSum = RSS14Reader.OUTSIDE_GSUM[group];\n            return new DataCharacter_1.default(vOdd * tEven + vEven + gSum, checksumPortion);\n        }\n        else {\n            if ((evenSum & 0x01) !== 0 || evenSum > 10 || evenSum < 4) {\n                throw new NotFoundException_1.default();\n            }\n            var group = (10 - evenSum) / 2;\n            var oddWidest = RSS14Reader.INSIDE_ODD_WIDEST[group];\n            var evenWidest = 9 - oddWidest;\n            var vOdd = RSSUtils_1.default.getRSSvalue(oddCounts, oddWidest, true);\n            var vEven = RSSUtils_1.default.getRSSvalue(evenCounts, evenWidest, false);\n            var tOdd = RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[group];\n            var gSum = RSS14Reader.INSIDE_GSUM[group];\n            return new DataCharacter_1.default(vEven * tOdd + vOdd + gSum, checksumPortion);\n        }\n    };\n    RSS14Reader.prototype.findFinderPattern = function (row, rightFinderPattern) {\n        var counters = this.getDecodeFinderCounters();\n        counters[0] = 0;\n        counters[1] = 0;\n        counters[2] = 0;\n        counters[3] = 0;\n        var width = row.getSize();\n        var isWhite = false;\n        var rowOffset = 0;\n        while (rowOffset < width) {\n            isWhite = !row.get(rowOffset);\n            if (rightFinderPattern === isWhite) {\n                // Will encounter white first when searching for right finder pattern\n                break;\n            }\n            rowOffset++;\n        }\n        var counterPosition = 0;\n        var patternStart = rowOffset;\n        for (var x = rowOffset; x < width; x++) {\n            if (row.get(x) !== isWhite) {\n                counters[counterPosition]++;\n            }\n            else {\n                if (counterPosition === 3) {\n                    if (AbstractRSSReader_1.default.isFinderPattern(counters)) {\n                        return [patternStart, x];\n                    }\n                    patternStart += counters[0] + counters[1];\n                    counters[0] = counters[2];\n                    counters[1] = counters[3];\n                    counters[2] = 0;\n                    counters[3] = 0;\n                    counterPosition--;\n                }\n                else {\n                    counterPosition++;\n                }\n                counters[counterPosition] = 1;\n                isWhite = !isWhite;\n            }\n        }\n        throw new NotFoundException_1.default();\n    };\n    RSS14Reader.prototype.parseFoundFinderPattern = function (row, rowNumber, right, startEnd) {\n        // Actually we found elements 2-5\n        var firstIsBlack = row.get(startEnd[0]);\n        var firstElementStart = startEnd[0] - 1;\n        // Locate element 1\n        while (firstElementStart >= 0 && firstIsBlack !== row.get(firstElementStart)) {\n            firstElementStart--;\n        }\n        firstElementStart++;\n        var firstCounter = startEnd[0] - firstElementStart;\n        // Make 'counters' hold 1-4\n        var counters = this.getDecodeFinderCounters();\n        var copy = new Array(counters.length);\n        System_1.default.arraycopy(counters, 0, copy, 1, counters.length - 1);\n        copy[0] = firstCounter;\n        var value = this.parseFinderValue(copy, RSS14Reader.FINDER_PATTERNS);\n        var start = firstElementStart;\n        var end = startEnd[1];\n        if (right) {\n            // row is actually reversed\n            start = row.getSize() - 1 - start;\n            end = row.getSize() - 1 - end;\n        }\n        return new FinderPattern_1.default(value, [firstElementStart, startEnd[1]], start, end, rowNumber);\n    };\n    RSS14Reader.prototype.adjustOddEvenCounts = function (outsideChar, numModules) {\n        var oddSum = MathUtils_1.default.sum(new Int32Array(this.getOddCounts()));\n        var evenSum = MathUtils_1.default.sum(new Int32Array(this.getEvenCounts()));\n        var incrementOdd = false;\n        var decrementOdd = false;\n        var incrementEven = false;\n        var decrementEven = false;\n        if (outsideChar) {\n            if (oddSum > 12) {\n                decrementOdd = true;\n            }\n            else if (oddSum < 4) {\n                incrementOdd = true;\n            }\n            if (evenSum > 12) {\n                decrementEven = true;\n            }\n            else if (evenSum < 4) {\n                incrementEven = true;\n            }\n        }\n        else {\n            if (oddSum > 11) {\n                decrementOdd = true;\n            }\n            else if (oddSum < 5) {\n                incrementOdd = true;\n            }\n            if (evenSum > 10) {\n                decrementEven = true;\n            }\n            else if (evenSum < 4) {\n                incrementEven = true;\n            }\n        }\n        var mismatch = oddSum + evenSum - numModules;\n        var oddParityBad = (oddSum & 0x01) === (outsideChar ? 1 : 0);\n        var evenParityBad = (evenSum & 0x01) === 1;\n        if (mismatch === 1) {\n            if (oddParityBad) {\n                if (evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                decrementOdd = true;\n            }\n            else {\n                if (!evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                decrementEven = true;\n            }\n        }\n        else if (mismatch === -1) {\n            if (oddParityBad) {\n                if (evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                incrementOdd = true;\n            }\n            else {\n                if (!evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                incrementEven = true;\n            }\n        }\n        else if (mismatch === 0) {\n            if (oddParityBad) {\n                if (!evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                // Both bad\n                if (oddSum < evenSum) {\n                    incrementOdd = true;\n                    decrementEven = true;\n                }\n                else {\n                    decrementOdd = true;\n                    incrementEven = true;\n                }\n            }\n            else {\n                if (evenParityBad) {\n                    throw new NotFoundException_1.default();\n                }\n                // Nothing to do!\n            }\n        }\n        else {\n            throw new NotFoundException_1.default();\n        }\n        if (incrementOdd) {\n            if (decrementOdd) {\n                throw new NotFoundException_1.default();\n            }\n            AbstractRSSReader_1.default.increment(this.getOddCounts(), this.getOddRoundingErrors());\n        }\n        if (decrementOdd) {\n            AbstractRSSReader_1.default.decrement(this.getOddCounts(), this.getOddRoundingErrors());\n        }\n        if (incrementEven) {\n            if (decrementEven) {\n                throw new NotFoundException_1.default();\n            }\n            AbstractRSSReader_1.default.increment(this.getEvenCounts(), this.getOddRoundingErrors());\n        }\n        if (decrementEven) {\n            AbstractRSSReader_1.default.decrement(this.getEvenCounts(), this.getEvenRoundingErrors());\n        }\n    };\n    RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET = [1, 10, 34, 70, 126];\n    RSS14Reader.INSIDE_ODD_TOTAL_SUBSET = [4, 20, 48, 81];\n    RSS14Reader.OUTSIDE_GSUM = [0, 161, 961, 2015, 2715];\n    RSS14Reader.INSIDE_GSUM = [0, 336, 1036, 1516];\n    RSS14Reader.OUTSIDE_ODD_WIDEST = [8, 6, 4, 3, 1];\n    RSS14Reader.INSIDE_ODD_WIDEST = [2, 4, 6, 8];\n    RSS14Reader.FINDER_PATTERNS = [\n        [3, 8, 2, 1],\n        [3, 5, 5, 1],\n        [3, 3, 7, 1],\n        [3, 1, 9, 1],\n        [2, 7, 4, 1],\n        [2, 5, 6, 1],\n        [2, 3, 8, 1],\n        [1, 5, 7, 1],\n        [1, 3, 9, 1],\n    ];\n    return RSS14Reader;\n}(AbstractRSSReader_1.default));\nexports.default = RSS14Reader;\n//# sourceMappingURL=RSS14Reader.js.map"]},"metadata":{},"sourceType":"script"}